# 1. 零拷贝

## what is Zero-Copy
“零拷贝”（Zero-Copy）是一种计算机技术，旨在减少数据在计算机系统中从源位置传输到目标位置时的CPU拷贝次数，从而提高数据传输效率，降低系统资源消耗。
传统的数据传输通常需要多次在用户空间和内核空间之间复制数据，而零拷贝技术通过优化内存访问路径，避免或减少这些不必要的拷贝操作。

## 零拷贝的核心思想
通过直接在内核空间完成数据传输，或让数据传输绕过用户空间，减少CPU参与数据拷贝的次数，从而：
减少CPU使用率：释放CPU资源用于其他任务。
降低内存带宽消耗：减少数据在内存中的移动次数。
提高吞吐量：加速数据传输速度。

## 常见实现方式
1.用户空间与内核空间的零拷贝
直接1/0：应用程序直接访问磁盘数据，绕过内核缓冲区（需特殊文件系统支持）。
内存映射（mmap）：通过mmap（）系统调用将文件直接映射到用户空间的地址空间，避免数据从内核空间到用户空间的拷贝（如Linux中的sendfile)。
2.内核空间内的零拷贝
sendfile系统调用（Linux)：直接在内核空间将文件数据传输到网络套接字，无需经过用户空间（如Nginx的sendfileon配置）。
spLice系统调用（Linux)：在内核空间的两个文件描述符之间直接传输数据，完全绕过用户空间。
3.硬件辅助零拷贝
网络适配器DMA：网卡直接从磁盘或内存读取数据，无需CPU干预（如iSCSI或RDMA)。
GPU直接内存访问：在图形处理中，GPU直接从内存读取数据，减少CPU参与。

## 应用场景
文件传输：如大文件下载、流媒体服务（减少数据从磁盘到网络的拷贝）。
网络代理/负载均衡：数据从客户端到服务器的转发（如Nginx、HAProxy）。
数据库系统：数据从磁盘读取到网络发送（如PostgreSQL的COPYTO)。
分布式存储：数据在节点间复制（如HDFS、Ceph)。

## go语言中的零拷贝
1.strings.Reader和bytes.Buffer：对于字符串和字节切片，strings.Reader和bytes.Buffer可以直接提供读取接口，避免数据复制

2.io.Copy是Go语言中实现零拷贝的核心函数，其源码逻辑如下：
优先使用WriterTo：如果src实现了WriterTo接口，则直接调用src.WriteTo（dst）。
其次使用ReaderFrom：如果dst实现了ReaderFrom接口，则直接调用dst.ReadFrom（src)。
最后使用缓冲区循环复制：如果上述接口均未实现，则使用默认缓冲区循环调用Read和Write

3.在实现HTTP文件服务器时，http.SerVeFile方法会自动使用零拷贝

4.通过unsafe包，可以绕过类型系统，直接操作内存地址，进而避免数据复制